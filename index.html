<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç…§ç‰‡æ¨™è¨»å·¥å…· (æ•™å­¸æ•´åˆç‰ˆ)</title>
    <style>
        :root {
            --primary: #007bff;
            --bg: #f4f6f9;
            --panel-bg: #ffffff;
            --border: #dee2e6;
        }
        body { font-family: "Microsoft JhengHei", "Segoe UI", sans-serif; margin: 0; padding: 20px; background: var(--bg); color: #333; height: 100vh; box-sizing: border-box; display: flex; flex-direction: column; }
        
        /* é ‚éƒ¨å°èˆª */
        .navbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .nav-title { margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .nav-actions { display: flex; gap: 10px; }

        /* ä¸»ä½ˆå±€ï¼šå·¦åœ–å³æ§ */
        .main-layout { display: grid; grid-template-columns: 1fr 320px; gap: 20px; flex: 1; min-height: 0; }
        
        /* å·¦å´ï¼šåœ–ç‰‡å€ */
        .image-panel { background: #222; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .image-panel img { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        .placeholder-text { color: #888; text-align: center; line-height: 1.6; }

        /* å³å´ï¼šæ§åˆ¶å€ (åŒ…å«è¨­å®š) */
        .sidebar { background: white; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* å€å¡Šæ¨£å¼ */
        .section-title { font-size: 0.9rem; font-weight: bold; color: #555; margin-bottom: 5px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        
        /* è¨­å®šå€ (Textarea) */
        .config-box textarea { width: 100%; height: 100px; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-family: monospace; font-size: 13px; resize: vertical; box-sizing: border-box; }
        .config-box textarea:focus { border-color: var(--primary); outline: none; }
        
        /* è³‡è¨Šé¢æ¿ */
        .info-card { background: #e9ecef; padding: 10px; border-radius: 4px; font-size: 0.85rem; border-left: 4px solid #17a2b8; }

        /* å¿«é€Ÿæ¨™ç±¤å€ */
        #quickTags { display: flex; flex-wrap: wrap; gap: 6px; }
        .tag-btn { background: #f8f9fa; border: 1px solid #ced4da; padding: 4px 10px; border-radius: 15px; cursor: pointer; font-size: 12px; transition: 0.2s; }
        .tag-btn:hover { background: #e2e6ea; border-color: #adb5bd; color: var(--primary); }

        /* è¼¸å…¥æ¡† */
        .input-group { position: relative; }
        .main-input { width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        .main-input:focus { border-color: var(--primary); outline: none; }
        .preview-text { font-size: 0.8rem; color: #888; text-align: right; margin-top: 4px; min-height: 1.2em; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn { border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 14px; }
        .btn-upload { background: #17a2b8; color: white; display: inline-flex; align-items: center; gap: 5px; }
        .btn-help { background: #6f42c1; color: white; }
        .btn-prev { background: #6c757d; color: white; }
        .btn-next { background: #007bff; color: white; flex: 1; }
        .btn-download { background: #fd7e14; color: white; width: 100%; padding: 12px; font-size: 16px; margin-top: auto; display: flex; justify-content: center; align-items: center; gap: 5px; }
        .btn-download:hover { background: #e96b02; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn-copy { background: #28a745; color: white; width: 100%; font-size: 13px; padding: 8px; opacity: 0.8; }
        .btn-copy:hover { opacity: 1; }

        /* --- æ•™å­¸è¦–çª— CSS (å¾©åˆ» Windows è­¦å‘Šæ¨£å¼) --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal-content { background: white; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; border-radius: 12px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideUp 0.3s ease; }
        
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; }
        
        /* æ­¥é©Ÿå¡ç‰‡ */
        .step-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .step-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; position: relative; }
        .step-badge { position: absolute; top: -10px; left: -10px; width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        /* å¾©åˆ» Windows å®‰å…¨æ€§è­¦å‘Š */
        .fake-windows-alert {
            border: 1px solid #d9d9d9;
            background: white;
            font-family: "Segoe UI", sans-serif;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .fake-alert-header {
            padding: 8px 12px;
            font-size: 12px;
            color: #000;
        }
        .fake-alert-banner {
            background: #ffcc00; /* Windows é»ƒè‰²è­¦å‘Šè‰² */
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .fake-alert-banner h3 { margin: 0; font-size: 16px; font-weight: normal; color: #000; }
        .fake-alert-icon {
            width: 24px; height: 24px;
            border: 2px solid #333; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-family: serif;
        }
        .fake-alert-content { padding: 15px; font-size: 13px; color: #333; }
        .fake-path { font-family: monospace; background: #f0f0f0; padding: 2px 5px; }

        /* è§£é–æ•™å­¸å€å¡Š */
        .unlock-tutorial {
            background: #eef2f7;
            padding: 15px;
            border-radius: 6px;
            border-left: 5px solid #fd7e14;
            margin-top: 15px;
        }
        .unlock-steps { margin: 10px 0 0 20px; font-size: 14px; line-height: 1.6; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 768px) {
            .main-layout { grid-template-columns: 1fr; grid-template-rows: 40vh 1fr; }
            body { height: auto; }
            .sidebar { max-height: none; overflow: visible; }
        }
    </style>
</head>
<body>

<div class="navbar">
    <div class="nav-title">
        <span>ğŸ“· ç…§ç‰‡æ¨™è¨»å·¥å…·</span>
        <span style="font-size:0.8em; color:#666; font-weight:normal;">(v2.0 æ•™å­¸æ•´åˆç‰ˆ)</span>
    </div>
    <div class="nav-actions">
        <button class="btn btn-help" onclick="toggleHelp()">â“ ä½¿ç”¨æ•™å­¸</button>
        <label for="folderInput" class="btn btn-upload" style="cursor:pointer;">ğŸ“‚ é¸æ“‡è³‡æ–™å¤¾</label>
        <input type="file" id="folderInput" webkitdirectory directory multiple style="display:none;">
    </div>
</div>

<div class="main-layout">
    
    <div class="image-panel">
        <img id="currentImage" src="" alt="">
        <div id="placeholder" class="placeholder-text">
            <h3>æº–å‚™é–‹å§‹</h3>
            <p>1. é»æ“Šå³ä¸Šè§’ã€Œé¸æ“‡è³‡æ–™å¤¾ã€<br>2. åƒè€ƒå³å´è¨­å®šæ¨™ç±¤<br>3. é‡åˆ°å•é¡Œé»æ“Šã€Œä½¿ç”¨æ•™å­¸ã€</p>
        </div>
    </div>

    <div class="sidebar">
        <div>
            <div class="section-title">âš™ï¸ æ¨™ç±¤è¨­å®š (ä¸­æ–‡,ä»£ç¢¼)</div>
            <div class="config-box">
                <textarea id="tagConfig" placeholder="æ ¼å¼ï¼šä¸­æ–‡åç¨±,è‹±æ–‡ä»£ç¢¼" oninput="renderQuickTags()">
å°åŒ—å±•è¦½,TPE_Expo
é«˜é›„å‡ºå·®,KHH_Trip
å“¡å·¥èšé¤,Dinner
ç”¢å“æ¸¬è©¦,Test</textarea>
            </div>
        </div>

        <div class="info-card">
            <div>åŸå§‹æª”å: <strong id="fileName">-</strong></div>
            <div style="margin-top:5px; color:#555;">é€²åº¦: <span id="progress">0 / 0</span></div>
        </div>

        <div>
            <div class="section-title">å¿«é€Ÿé»é¸</div>
            <div id="quickTags"></div>
        </div>

        <div>
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <label style="font-weight:bold;">æ–°æª”åä»£ç¢¼:</label>
                <a href="#" onclick="clearInput()" style="color:#dc3545; font-size:12px;">æ¸…é™¤</a>
            </div>
            <div class="input-group">
                <input type="text" id="newTag" class="main-input" placeholder="è¼¸å…¥æˆ–é»é¸..." onkeydown="checkEnter(event)" oninput="updatePreview(this)">
            </div>
            <div id="namePreview" class="preview-text">é è¦½: -</div>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn btn-prev" onclick="prevImage()">â† ä¸Šä¸€å¼µ</button>
            <button class="btn btn-next" onclick="nextImage()">ä¸‹ä¸€å¼µ (Enter)</button>
        </div>

        <div style="border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; display:flex; flex-direction:column; gap:8px;">
            <button class="btn btn-download" onclick="exportBat()">
                <span>âš¡</span> ä¸‹è¼‰è‡ªå‹•æ”¹åæª” (.bat)
            </button>
            <button class="btn btn-copy" onclick="copyBatCode()">ğŸ“‹ è¤‡è£½ä»£ç¢¼ (å‚™ç”¨æ–¹æ¡ˆ)</button>
        </div>
    </div>
</div>

<div id="helpModal" class="modal-overlay" onclick="toggleHelp()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2 style="margin:0;">ğŸ“– ä½¿ç”¨æ•™å­¸èˆ‡æ•…éšœæ’é™¤</h2>
            <button onclick="toggleHelp()" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div class="modal-body">
            
            <div class="step-grid">
                <div class="step-card">
                    <div class="step-badge">1</div>
                    <h4>è¨­å®šèˆ‡åŒ¯å…¥</h4>
                    <p>å…ˆåœ¨å³å´ã€Œæ¨™ç±¤è¨­å®šã€è¼¸å…¥å¸¸ç”¨çš„ä»£ç¢¼ã€‚æ¥è‘—é»æ“Šå³ä¸Šè§’ã€Œé¸æ“‡è³‡æ–™å¤¾ã€è¼‰å…¥ç…§ç‰‡ã€‚</p>
                </div>
                <div class="step-card">
                    <div class="step-badge">2</div>
                    <h4>æ¨™è¨»éç¨‹</h4>
                    <p>çœ‹åœ– â” é»æ¨™ç±¤ (æˆ–è¼¸å…¥) â” æŒ‰ Enterã€‚ç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šæµæ°´è™Ÿ (å¦‚ _001) é¿å…é‡è¤‡ã€‚</p>
                </div>
                <div class="step-card">
                    <div class="step-badge">3</div>
                    <h4>ä¸‹è¼‰èˆ‡åŸ·è¡Œ</h4>
                    <p>å…¨éƒ¨å®Œæˆå¾Œï¼Œé»æ“Šæ©˜è‰²æŒ‰éˆ•ä¸‹è¼‰ <code>é–‹å§‹æ”¹å.bat</code>ï¼Œä¸¦å°‡å…¶æ”¾åœ¨ç…§ç‰‡è³‡æ–™å¤¾å…§åŸ·è¡Œã€‚</p>
                </div>
            </div>

            <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">

            <h3 style="color:#dc3545;">ğŸš¨ å¸¸è¦‹å•é¡Œï¼šç‚ºä»€éº¼ä¸èƒ½åŸ·è¡Œï¼Ÿ</h3>
            <p>å¦‚æœæ‚¨é»å…©ä¸‹ <code>.bat</code> æª”å‡ºç¾ä»¥ä¸‹ç•«é¢ï¼ˆWindows è—è‰²æˆ–é»ƒè‰²è­¦å‘Šï¼‰ï¼š</p>

            <div class="fake-windows-alert">
                <div class="fake-alert-header">Windows å®‰å…¨æ€§</div>
                <div class="fake-alert-banner">
                    <div class="fake-alert-icon">!</div>
                    <h3>ç„¡æ³•é–‹å•Ÿé€™äº›æª”æ¡ˆ</h3>
                </div>
                <div class="fake-alert-content">
                    <p>ç¶²éš›ç¶²è·¯å®‰å…¨æ€§è¨­å®šå°è‡´ç„¡æ³•é–‹å•Ÿä¸€æˆ–å¤šå€‹æª”æ¡ˆã€‚</p>
                    <p class="fake-path">C:\Users\User\Desktop\ç…§ç‰‡\é–‹å§‹æ”¹å.bat</p>
                    <div style="text-align:right; margin-top:10px;">
                        <button style="padding:5px 15px;">é—œé–‰(C)</button>
                    </div>
                </div>
            </div>

            <div class="unlock-tutorial">
                <h4 style="margin:0 0 10px 0;">âœ… è§£æ±ºæ–¹æ³• (åªéœ€åšä¸€æ¬¡)ï¼š</h4>
                <ol class="unlock-steps">
                    <li>å°è‘— <code>é–‹å§‹æ”¹å.bat</code> é»æ“Š <strong>æ»‘é¼ å³éµ</strong>ã€‚</li>
                    <li>é¸æ“‡æœ€ä¸‹æ–¹çš„ <strong>ã€Œå…§å®¹ (Properties)ã€</strong>ã€‚</li>
                    <li>åœ¨è¦–çª—æœ€ä¸‹æ–¹ï¼Œå‹¾é¸ <strong>ã€Œè§£é™¤é–å®š (Unblock)ã€</strong>ã€‚</li>
                    <li>æŒ‰ä¸‹ã€Œç¢ºå®šã€ï¼Œå†æ¬¡åŸ·è¡Œå³å¯ï¼</li>
                </ol>
            </div>

            <div style="text-align:center; margin-top:30px;">
                <button class="btn btn-next" onclick="toggleHelp()" style="width:200px;">æˆ‘å­¸æœƒäº†ï¼Œé–‹å§‹æ¨™è¨»ï¼</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒè®Šæ•¸ ---
    let files = [], fileData = [], currentIndex = 0;
    
    // --- DOM å…ƒç´  ---
    const UI = {
        folderInput: document.getElementById('folderInput'),
        img: document.getElementById('currentImage'),
        placeholder: document.getElementById('placeholder'),
        fileName: document.getElementById('fileName'),
        progress: document.getElementById('progress'),
        tagInput: document.getElementById('newTag'),
        tagConfig: document.getElementById('tagConfig'),
        quickTags: document.getElementById('quickTags'),
        preview: document.getElementById('namePreview')
    };

    // --- åˆå§‹åŒ– ---
    // setTimeout(toggleHelp, 500); // å¦‚æœæƒ³é è¨­é–‹å•Ÿæ•™å­¸ï¼Œå–æ¶ˆæ­¤è¨»è§£
    renderQuickTags();

    // --- åŠŸèƒ½å‡½å¼ ---
    function toggleHelp() {
        const modal = document.getElementById('helpModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    function renderQuickTags() {
        UI.quickTags.innerHTML = '';
        const lines = UI.tagConfig.value.trim().split('\n');
        lines.forEach(line => {
            const parts = line.split(/[,ï¼Œ]/);
            if (parts.length >= 2) {
                const label = parts[0].trim();
                const code = parts[1].trim();
                if (label && code) {
                    const btn = document.createElement('button');
                    btn.className = 'tag-btn';
                    btn.textContent = `${label}`;
                    btn.title = code; // Hover é¡¯ç¤ºä»£ç¢¼
                    btn.onclick = () => addTag(code);
                    UI.quickTags.appendChild(btn);
                }
            }
        });
    }

    function addTag(code) {
        const val = UI.tagInput.value.trim();
        UI.tagInput.value = val ? (val.endsWith(code) ? val : val + "_" + code) : code;
        UI.tagInput.focus();
        updatePreview(UI.tagInput);
    }

    function clearInput() { 
        UI.tagInput.value = ""; 
        UI.tagInput.focus(); 
        updatePreview(UI.tagInput);
    }

    function updatePreview(input) {
        // 1. ç§»é™¤ windows éæ³•å­—å…ƒ
        input.value = input.value.replace(/[\\/:*?"<>|]/g, '');
        
        // 2. é è¦½é‚è¼¯
        if (!files.length) { UI.preview.textContent = "é è¦½: -"; return; }
        
        const currentTag = input.value.trim();
        const ext = files[currentIndex].name.split('.').pop();
        
        if (!currentTag) {
            UI.preview.textContent = "é è¦½: (ç¶­æŒåŸæª”å)";
        } else {
            // é€™è£¡é¡¯ç¤º _XXX è®“ä½¿ç”¨è€…çŸ¥é“æœƒæœ‰æµæ°´è™Ÿ
            UI.preview.textContent = `é è¦½: ${currentTag}_XXX.${ext}`;
        }
    }

    // --- æª”æ¡ˆè™•ç† ---
    UI.folderInput.addEventListener('change', function(e) {
        files = Array.from(e.target.files).filter(f => f.type.startsWith('image/'));
        if (files.length === 0) { alert("æ­¤è³‡æ–™å¤¾æ²’æœ‰åœ–ç‰‡ï¼"); return; }
        
        // åˆå§‹åŒ–æ•¸æ“š
        fileData = files.map(f => ({ originalName: f.name, tag: "" }));
        
        // è‡ªç„¶æ’åº (1, 2, 10 è€Œä¸æ˜¯ 1, 10, 2)
        const collator = new Intl.Collator(undefined, {numeric: true, sensitivity: 'base'});
        files.sort((a, b) => collator.compare(a.name, b.name));
        fileData.sort((a, b) => collator.compare(a.originalName, b.originalName));

        currentIndex = 0;
        loadUI();
    });

    function loadUI() {
        if (!files.length) return;
        
        // é‡‹æ”¾è¨˜æ†¶é«”
        if (UI.img.src) URL.revokeObjectURL(UI.img.src);

        UI.img.src = URL.createObjectURL(files[currentIndex]);
        UI.img.style.display = 'block';
        UI.placeholder.style.display = 'none';
        
        UI.fileName.textContent = files[currentIndex].name;
        UI.progress.textContent = `${currentIndex + 1} / ${files.length}`;
        
        UI.tagInput.value = fileData[currentIndex].tag;
        UI.tagInput.focus();
        updatePreview(UI.tagInput);
    }

    function saveCurrent() { 
        if (files.length) fileData[currentIndex].tag = UI.tagInput.value.trim(); 
    }
    
    function nextImage() {
        saveCurrent();
        if (currentIndex < files.length - 1) { 
            currentIndex++; 
            loadUI(); 
        } else { 
            // ç°¡å–®æç¤º
            const btn = document.querySelector('.btn-download');
            btn.style.animation = "shake 0.5s"; // è®“æŒ‰éˆ•æ™ƒå‹•ä¸€ä¸‹æç¤º
            setTimeout(()=>btn.style.animation="", 500);
            alert("å·²æ˜¯æœ€å¾Œä¸€å¼µï¼è«‹é»æ“Šå³ä¸‹è§’ä¸‹è¼‰æŒ‰éˆ•ã€‚"); 
        }
    }
    
    function prevImage() {
        saveCurrent();
        if (currentIndex > 0) { currentIndex--; loadUI(); }
    }

    function checkEnter(e) { if (e.key === "Enter") nextImage(); }
    
    // éµç›¤ç›£è½
    document.addEventListener('keydown', (e) => {
        // å¦‚æœç„¦é»ä¸åœ¨è¼¸å…¥æ¡† (ä¾‹å¦‚é»äº†æŒ‰éˆ•)ï¼Œæ‰å•Ÿç”¨å·¦å³éµ
        if (document.activeElement !== UI.tagInput && files.length) {
            if (e.key === "ArrowRight") nextImage();
            if (e.key === "ArrowLeft") prevImage();
        }
    });
    
    // é›¢é–‹å‰è­¦å‘Š
    window.onbeforeunload = function() {
        if (files.length > 0) return "è®Šæ›´å°šæœªå„²å­˜ï¼Œç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ";
    };

    // --- ç”¢ç”Ÿ .bat é‚è¼¯ (å«æµæ°´è™Ÿ) ---
    function generateBatContent() {
        if (!files.length) return null;
        saveCurrent();

        let batContent = "@echo off\r\nchcp 65001 >nul\r\necho æ­£åœ¨è™•ç†æ”¹å...\r\n\r\n";
        let tagCounts = {}; 

        let renameCount = 0;
        fileData.forEach(item => {
            if (!item.tag) return; // æ²’æ¨™ç±¤å°±ä¸æ”¹

            if (!tagCounts[item.tag]) tagCounts[item.tag] = 0;
            tagCounts[item.tag]++;
            
            // ç”¢ç”Ÿæµæ°´è™Ÿ 001, 002...
            let seq = String(tagCounts[item.tag]).padStart(3, '0');
            let ext = item.originalName.split('.').pop();
            let newName = `${item.tag}_${seq}.${ext}`;
            
            batContent += `ren "${item.originalName}" "${newName}"\r\n`;
            renameCount++;
        });

        batContent += `\r\necho.\r\necho ------------------------------\r\n`;
        batContent += `echo è™•ç†å®Œæˆï¼å…± ${renameCount} å€‹æª”æ¡ˆã€‚\r\n`;
        batContent += `echo è‹¥å‡ºç¾ã€Œæª”åé‡è¤‡ã€æˆ–ã€Œæ‰¾ä¸åˆ°æª”æ¡ˆã€ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦å·²æ”¹åéã€‚\r\n`;
        batContent += `echo ------------------------------\r\npause`;
        
        return batContent;
    }

    function exportBat() {
        const content = generateBatContent();
        if (!content) { alert("é‚„æ²’æœ‰è¼‰å…¥ç…§ç‰‡å–”ï¼"); return; }
        
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "é–‹å§‹æ”¹å.bat";
        link.click();
        
        // ä¸‹è¼‰å¾Œè‡ªå‹•é–‹å•Ÿæ•™å­¸ï¼Œæé†’è§£é–
        setTimeout(() => {
            toggleHelp();
            // è‡ªå‹•æ²å‹•åˆ°è§£é–æ•™å­¸éƒ¨åˆ†
            const tutorialDiv = document.querySelector('.unlock-tutorial');
            if(tutorialDiv) tutorialDiv.scrollIntoView({behavior: "smooth"});
        }, 1200);
    }

    function copyBatCode() {
        const content = generateBatContent();
        if (!content) { alert("æ²’æœ‰è³‡æ–™å¯è¤‡è£½"); return; }
        
        navigator.clipboard.writeText(content).then(() => {
            alert("âœ… ä»£ç¢¼å·²è¤‡è£½ï¼\n\nå¦‚æœä¸‹è¼‰çš„ .bat è¢«é›»è…¦æ“‹ä½ï¼Œè«‹ï¼š\n1. é–‹å•Ÿè¨˜äº‹æœ¬\n2. è²¼ä¸Šä»£ç¢¼\n3. å¦å­˜æ–°æª” -> ç·¨ç¢¼é¸ UTF-8 -> æª”åå­˜ç‚º run.bat");
        }).catch(() => {
            alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•ä¸‹è¼‰ã€‚");
        });
    }
</script>

<style>
/* æŒ‰éˆ•æ™ƒå‹•å‹•ç•« */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}
</style>
</body>
</html>
